  [1m[35m (107.4ms)[0m  [1m[35mCREATE DATABASE "pockethealth_challenge_development" ENCODING = 'unicode' /*application='PockethealthChallenge'*/[0m
  [1m[35m (107.9ms)[0m  [1m[35mCREATE DATABASE "pockethealth_challenge_development" ENCODING = 'unicode' /*application='PockethealthChallenge'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO public /*application='PockethealthChallenge'*/[0m
  [1m[35m (627.5ms)[0m  [1m[35mCREATE DATABASE "pockethealth_challenge_development" ENCODING = 'unicode' /*application='PockethealthChallenge'*/[0m
  [1m[35mSQL (0.1ms)[0m  [1m[35mSET search_path TO public /*application='PockethealthChallenge'*/[0m
  [1m[35m (206.8ms)[0m  [1m[35mCREATE DATABASE "pockethealth_challenge_test" ENCODING = 'unicode' /*application='PockethealthChallenge'*/[0m
  [1m[35m (126.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY) /*application='PockethealthChallenge'*/[0m
  [1m[35m (5.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL) /*application='PockethealthChallenge'*/[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT pg_try_advisory_lock(8641812598185061470) /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveRecord::InternalMetadata Create (40.5ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'development', '2025-02-17 19:11:14.654658', '2025-02-17 19:11:14.654663') RETURNING "key" /*application='PockethealthChallenge'*/[0m
Migrating to CreateActiveStorageTables (20250217184629)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN /*application='PockethealthChallenge'*/[0m
  [1m[35m (50.9ms)[0m  [1m[35mCREATE TABLE "active_storage_blobs" ("id" bigserial primary key, "key" character varying NOT NULL, "filename" character varying NOT NULL, "content_type" character varying, "metadata" text, "service_name" character varying NOT NULL, "byte_size" bigint NOT NULL, "checksum" character varying, "created_at" timestamp(6) NOT NULL) /*application='PockethealthChallenge'*/[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_active_storage_blobs_on_key" ON "active_storage_blobs" ("key") /*application='PockethealthChallenge'*/[0m
  [1m[35m (5.3ms)[0m  [1m[35mCREATE TABLE "active_storage_attachments" ("id" bigserial primary key, "name" character varying NOT NULL, "record_type" character varying NOT NULL, "record_id" bigint NOT NULL, "blob_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_c3b3935057"
FOREIGN KEY ("blob_id")
  REFERENCES "active_storage_blobs" ("id")
) /*application='PockethealthChallenge'*/[0m
  [1m[35m (41.2ms)[0m  [1m[35mCREATE INDEX "index_active_storage_attachments_on_blob_id" ON "active_storage_attachments" ("blob_id") /*application='PockethealthChallenge'*/[0m
  [1m[35m (42.5ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_active_storage_attachments_uniqueness" ON "active_storage_attachments" ("record_type", "record_id", "name", "blob_id") /*application='PockethealthChallenge'*/[0m
  [1m[35m (42.0ms)[0m  [1m[35mCREATE TABLE "active_storage_variant_records" ("id" bigserial primary key, "blob_id" bigint NOT NULL, "variation_digest" character varying NOT NULL, CONSTRAINT "fk_rails_993965df05"
FOREIGN KEY ("blob_id")
  REFERENCES "active_storage_blobs" ("id")
) /*application='PockethealthChallenge'*/[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_active_storage_variant_records_uniqueness" ON "active_storage_variant_records" ("blob_id", "variation_digest") /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250217184629') RETURNING "version" /*application='PockethealthChallenge'*/[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT /*application='PockethealthChallenge'*/[0m
  [1m[35m (1.9ms)[0m  [1m[34mSELECT pg_advisory_unlock(8641812598185061470) /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='PockethealthChallenge'*/[0m
DICOM: DICOM string successfully parsed.
DICOM: DICOM file successfully read: /Users/Io/pockethealth-challenge/test/fixtures/files/DICOMDIR
DICOM: Expected a file, got a directory: /Users/Io/pockethealth-challenge/test/fixtures/files/PA000001/ST000001/SE000002
DICOM: Reading DICOM file failed: /Users/Io/pockethealth-challenge/test/fixtures/files/PA000001/ST000001/SE000002
DICOM: DICOM string successfully parsed.
DICOM: DICOM file successfully read: /Users/Io/pockethealth-challenge/test/fixtures/files/PA000001/ST000001/SE000002/IM000001
  [1m[35m (0.3ms)[0m  [1m[34mSELECT pg_try_advisory_lock(8641812598185061470) /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='PockethealthChallenge'*/[0m
Migrating to CreatePatientRecords (20250217194000)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='PockethealthChallenge'*/[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK /*application='PockethealthChallenge'*/[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_advisory_unlock(8641812598185061470) /*application='PockethealthChallenge'*/[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT pg_try_advisory_lock(8641812598185061470) /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='PockethealthChallenge'*/[0m
Migrating to CreatePatientRecords (20250217194000)
  [1m[35m (0.5ms)[0m  [1m[34mSELECT pg_advisory_unlock(8641812598185061470) /*application='PockethealthChallenge'*/[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT pg_try_advisory_lock(8641812598185061470) /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='PockethealthChallenge'*/[0m
Migrating to CreatePatientRecords (20250217194000)
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_advisory_unlock(8641812598185061470) /*application='PockethealthChallenge'*/[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_try_advisory_lock(8641812598185061470) /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='PockethealthChallenge'*/[0m
Migrating to CreatePatientRecords (20250217194000)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='PockethealthChallenge'*/[0m
  [1m[35m (14.7ms)[0m  [1m[35mCREATE TABLE "patient_records" ("id" uuid NOT NULL PRIMARY KEY, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL) /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveRecord::SchemaMigration Create (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250217194000') RETURNING "version" /*application='PockethealthChallenge'*/[0m
  [1m[36mTRANSACTION (2.0ms)[0m  [1m[35mCOMMIT /*application='PockethealthChallenge'*/[0m
  [1m[35m (1.5ms)[0m  [1m[34mSELECT pg_advisory_unlock(8641812598185061470) /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='PockethealthChallenge'*/[0m
DICOM: DICOM string successfully parsed.
DICOM: DICOM file successfully read: /Users/Io/pockethealth-challenge/test/fixtures/files/PA000001/ST000001/SE000002/IM000001
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*application='PockethealthChallenge'*/[0m
  [1m[36mPatientRecord Create (54.6ms)[0m  [1m[32mINSERT INTO "patient_records" ("created_at", "updated_at") VALUES ('2025-02-17 20:35:39.928118', '2025-02-17 20:35:39.928118') RETURNING "id" /*application='PockethealthChallenge'*/[0m
  [1m[36mTRANSACTION (48.1ms)[0m  [1m[31mROLLBACK /*application='PockethealthChallenge'*/[0m
  [1m[36mTRANSACTION (7.4ms)[0m  [1m[35mBEGIN /*application='PockethealthChallenge'*/[0m
  [1m[36mPatientRecord Create (26.3ms)[0m  [1m[32mINSERT INTO "patient_records" ("id", "created_at", "updated_at") VALUES ('386d2f4a-875a-4994-9bf4-8aae82855490', '2025-02-17 20:36:09.179839', '2025-02-17 20:36:09.179839') RETURNING "id" /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveStorage::Blob Load (126.4ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" INNER JOIN "active_storage_attachments" ON "active_storage_blobs"."id" = "active_storage_attachments"."blob_id" WHERE "active_storage_attachments"."record_id" = 386 AND "active_storage_attachments"."record_type" = 'PatientRecord' AND "active_storage_attachments"."name" = 'dicom' LIMIT 1 /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveStorage::Attachment Load (0.5ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = 386 AND "active_storage_attachments"."record_type" = 'PatientRecord' AND "active_storage_attachments"."name" = 'dicom' LIMIT 1 /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveStorage::Blob Create (0.9ms)[0m  [1m[32mINSERT INTO "active_storage_blobs" ("key", "filename", "content_type", "metadata", "service_name", "byte_size", "checksum", "created_at") VALUES ('qtku4xkarb7vsvquwzr91bdcjo4m', 'IM000001', 'application/dicom', '{"identified":true}', 'local', 586394, '0ptuzwN5PfenXnpMk68Keg==', '2025-02-17 20:36:09.706160') RETURNING "id" /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveStorage::Attachment Create (1.5ms)[0m  [1m[32mINSERT INTO "active_storage_attachments" ("name", "record_type", "record_id", "blob_id", "created_at") VALUES ('dicom', 'PatientRecord', 386, 1, '2025-02-17 20:36:09.715242') RETURNING "id" /*application='PockethealthChallenge'*/[0m
  [1m[36mPatientRecord Update (32.7ms)[0m  [1m[33mUPDATE "patient_records" SET "updated_at" = '2025-02-17 20:36:09.720087' WHERE "patient_records"."id" = '386d2f4a-875a-4994-9bf4-8aae82855490' /*application='PockethealthChallenge'*/[0m
  [1m[36mTRANSACTION (3.4ms)[0m  [1m[35mCOMMIT /*application='PockethealthChallenge'*/[0m
[36m  Disk Storage (15.9ms) [0m[32mUploaded file to key: qtku4xkarb7vsvquwzr91bdcjo4m (checksum: 0ptuzwN5PfenXnpMk68Keg==)[0m
  [1m[36mTRANSACTION (51.4ms)[0m  [1m[35mBEGIN /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveStorage::Blob Update (53.6ms)[0m  [1m[33mUPDATE "active_storage_blobs" SET "metadata" = '{"identified":true,"analyzed":true}' WHERE "active_storage_blobs"."id" = 1 /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveStorage::Attachment Load (3.0ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."blob_id" = 1 /*application='PockethealthChallenge'*/[0m
  [1m[36mPatientRecord Load (1.2ms)[0m  [1m[34mSELECT "patient_records".* FROM "patient_records" WHERE "patient_records"."id" = NULL /*application='PockethealthChallenge'*/[0m
  [1m[36mTRANSACTION (55.6ms)[0m  [1m[35mCOMMIT /*application='PockethealthChallenge'*/[0m
  [1m[36mPatientRecord Load (68.8ms)[0m  [1m[34mSELECT "patient_records".* FROM "patient_records" WHERE "patient_records"."id" = '386d2f4a-875a-4994-9bf4-8aae82855490' LIMIT 1 /*application='PockethealthChallenge'*/[0m
  [1m[36mPatientRecord Load (10.0ms)[0m  [1m[34mSELECT "patient_records".* FROM "patient_records" WHERE "patient_records"."id" = '386d2f4a-875a-4994-9bf4-8aae82855490' LIMIT 1 /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveStorage::Attachment Load (4.0ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = 386 AND "active_storage_attachments"."record_type" = 'PatientRecord' AND "active_storage_attachments"."name" = 'dicom' LIMIT 1 /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveStorage::Blob Load (2.2ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" WHERE "active_storage_blobs"."id" = 1 LIMIT 1 /*application='PockethealthChallenge'*/[0m
  [1m[36mPatientRecord Count (25.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "patient_records" /*application='PockethealthChallenge'*/[0m
  [1m[36mPatientRecord Load (1.0ms)[0m  [1m[34mSELECT "patient_records".* FROM "patient_records" ORDER BY "patient_records"."id" ASC LIMIT 1 /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveStorage::Attachment Load (2.9ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = 386 AND "active_storage_attachments"."record_type" = 'PatientRecord' AND "active_storage_attachments"."name" = 'dicom' LIMIT 1 /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveStorage::Blob Load (0.7ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" WHERE "active_storage_blobs"."id" = 1 LIMIT 1 /*application='PockethealthChallenge'*/[0m
DICOM: DICOM string successfully parsed.
DICOM: DICOM file successfully read: /Users/Io/pockethealth-challenge/storage/qt/ku/qtku4xkarb7vsvquwzr91bdcjo4m
  [1m[36mPatientRecord Load (1.1ms)[0m  [1m[34mSELECT "patient_records".* FROM "patient_records" ORDER BY "patient_records"."id" ASC LIMIT 1 /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveStorage::Attachment Load (1.4ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = 386 AND "active_storage_attachments"."record_type" = 'PatientRecord' AND "active_storage_attachments"."name" = 'dicom' LIMIT 1 /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveStorage::Blob Load (1.2ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" WHERE "active_storage_blobs"."id" = 1 LIMIT 1 /*application='PockethealthChallenge'*/[0m
DICOM: DICOM string successfully parsed.
DICOM: DICOM file successfully read: /Users/Io/pockethealth-challenge/storage/qt/ku/qtku4xkarb7vsvquwzr91bdcjo4m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='PockethealthChallenge'*/[0m
  [1m[36mPatientRecord Create (2.4ms)[0m  [1m[32mINSERT INTO "patient_records" ("id", "created_at", "updated_at") VALUES ('b2109def-8480-428b-951b-64e334bbef7f', '2025-02-17 20:47:36.229441', '2025-02-17 20:47:36.229441') RETURNING "id" /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveStorage::Blob Load (0.8ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" INNER JOIN "active_storage_attachments" ON "active_storage_blobs"."id" = "active_storage_attachments"."blob_id" WHERE "active_storage_attachments"."record_id" = NULL AND "active_storage_attachments"."record_type" = 'PatientRecord' AND "active_storage_attachments"."name" = 'dicom' LIMIT 1 /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveStorage::Attachment Load (0.3ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = NULL AND "active_storage_attachments"."record_type" = 'PatientRecord' AND "active_storage_attachments"."name" = 'dicom' LIMIT 1 /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveStorage::Blob Create (41.2ms)[0m  [1m[32mINSERT INTO "active_storage_blobs" ("key", "filename", "content_type", "metadata", "service_name", "byte_size", "checksum", "created_at") VALUES ('c8yu4q71eh9mbplqi3jbuumas9fc', 'IM000002', 'application/dicom', '{"identified":true}', 'local', 586392, '4AE2eKkEiB9SvJu340+8GA==', '2025-02-17 20:47:36.297212') RETURNING "id" /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveStorage::Attachment Create (5.5ms)[0m  [1m[32mINSERT INTO "active_storage_attachments" ("name", "record_type", "record_id", "blob_id", "created_at") VALUES ('dicom', 'PatientRecord', 0, 2, '2025-02-17 20:47:36.340577') RETURNING "id" /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveStorage::Attachment Update (1.0ms)[0m  [1m[33mUPDATE "active_storage_attachments" SET "record_id" = 0 WHERE "active_storage_attachments"."id" = 2 /*application='PockethealthChallenge'*/[0m
  [1m[36mPatientRecord Load (0.8ms)[0m  [1m[34mSELECT "patient_records".* FROM "patient_records" WHERE "patient_records"."id" = NULL LIMIT 1 /*application='PockethealthChallenge'*/[0m
  [1m[36mPatientRecord Update (0.4ms)[0m  [1m[33mUPDATE "patient_records" SET "updated_at" = '2025-02-17 20:47:36.390308' WHERE "patient_records"."id" = 'b2109def-8480-428b-951b-64e334bbef7f' /*application='PockethealthChallenge'*/[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT /*application='PockethealthChallenge'*/[0m
[36m  Disk Storage (42.9ms) [0m[32mUploaded file to key: c8yu4q71eh9mbplqi3jbuumas9fc (checksum: 4AE2eKkEiB9SvJu340+8GA==)[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveStorage::Blob Update (7.7ms)[0m  [1m[33mUPDATE "active_storage_blobs" SET "metadata" = '{"identified":true,"analyzed":true}' WHERE "active_storage_blobs"."id" = 2 /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveStorage::Attachment Load (2.3ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."blob_id" = 2 /*application='PockethealthChallenge'*/[0m
  [1m[36mPatientRecord Load (1.7ms)[0m  [1m[34mSELECT "patient_records".* FROM "patient_records" WHERE "patient_records"."id" = NULL /*application='PockethealthChallenge'*/[0m
  [1m[36mTRANSACTION (41.7ms)[0m  [1m[35mCOMMIT /*application='PockethealthChallenge'*/[0m
  [1m[36mPatientRecord Count (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "patient_records" /*application='PockethealthChallenge'*/[0m
Started GET "/patient_records/b2109def-8480-428b-951b-64e334bbef7f/headers?tag=0010,0010" for 127.0.0.1 at 2025-02-17 15:56:58 -0500
  [1m[36mActiveRecord::SchemaMigration Load (1.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='PockethealthChallenge'*/[0m
  
ActionController::RoutingError (No route matches [GET] "/patient_records/b2109def-8480-428b-951b-64e334bbef7f/headers"):
  
Started GET "/patient_records/b2109def-8480-428b-951b-64e334bbef7f/headers?tag=0010,0010" for 127.0.0.1 at 2025-02-17 15:58:46 -0500
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='PockethealthChallenge'*/[0m
  
SyntaxError (/Users/Io/pockethealth-challenge/app/controllers/patient_records_controller.rb:19: syntax error, unexpected end-of-input, expecting `end' or dummy end):
  
app/controllers/patient_records_controller.rb:19: syntax error, unexpected end-of-input, expecting `end' or dummy end
Started GET "/patient_records/b2109def-8480-428b-951b-64e334bbef7f/headers?tag=0010,0010" for 127.0.0.1 at 2025-02-17 15:59:36 -0500
Processing by PatientRecordsController#headers as */*
  Parameters: {"tag"=>"0010,0010", "id"=>"b2109def-8480-428b-951b-64e334bbef7f"}
  [1m[36mPatientRecord Load (1.1ms)[0m  [1m[34mSELECT "patient_records".* FROM "patient_records" WHERE "patient_records"."id" = 'b2109def-8480-428b-951b-64e334bbef7f' LIMIT 1 /*action='headers',application='PockethealthChallenge',controller='patient_records'*/[0m
  ↳ app/controllers/patient_records_controller.rb:3:in `headers'
  [1m[36mActiveStorage::Attachment Load (6.4ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = NULL AND "active_storage_attachments"."record_type" = 'PatientRecord' AND "active_storage_attachments"."name" = 'dicom' LIMIT 1 /*action='headers',application='PockethealthChallenge',controller='patient_records'*/[0m
  ↳ app/models/patient_record.rb:19:in `get_dicom_path'
Completed 500 Internal Server Error in 315ms (ActiveRecord: 48.3ms (2 queries, 0 cached) | GC: 1.0ms)


  
NoMethodError (undefined method `[]' for nil):
  
app/models/patient_record.rb:19:in `get_dicom_path'
app/models/patient_record.rb:10:in `get_tag_value'
app/controllers/patient_records_controller.rb:4:in `headers'
Started GET "/patient_records/b2109def-8480-428b-951b-64e334bbef7f/headers?tag=0010,0010" for 127.0.0.1 at 2025-02-17 16:00:38 -0500
Processing by PatientRecordsController#headers as */*
  Parameters: {"tag"=>"0010,0010", "id"=>"b2109def-8480-428b-951b-64e334bbef7f"}
  [1m[36mPatientRecord Load (0.5ms)[0m  [1m[34mSELECT "patient_records".* FROM "patient_records" WHERE "patient_records"."id" = 'b2109def-8480-428b-951b-64e334bbef7f' LIMIT 1 /*action='headers',application='PockethealthChallenge',controller='patient_records'*/[0m
  ↳ app/controllers/patient_records_controller.rb:3:in `headers'
  [1m[36mActiveStorage::Attachment Load (0.9ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = NULL AND "active_storage_attachments"."record_type" = 'PatientRecord' AND "active_storage_attachments"."name" = 'dicom' LIMIT 1 /*action='headers',application='PockethealthChallenge',controller='patient_records'*/[0m
  ↳ (byebug):1:in `get_dicom_path'
Completed 500 Internal Server Error in 181402ms (ActiveRecord: 31.1ms (2 queries, 0 cached) | GC: 148.0ms)


  
NoMethodError (undefined method `[]' for nil):
  
app/models/patient_record.rb:20:in `get_dicom_path'
app/models/patient_record.rb:10:in `get_tag_value'
app/controllers/patient_records_controller.rb:4:in `headers'
Started GET "/patient_records/b2109def-8480-428b-951b-64e334bbef7f/headers?tag=0010,0010" for 127.0.0.1 at 2025-02-17 16:03:44 -0500
Processing by PatientRecordsController#headers as */*
  Parameters: {"tag"=>"0010,0010", "id"=>"b2109def-8480-428b-951b-64e334bbef7f"}
  [1m[36mPatientRecord Load (0.3ms)[0m  [1m[34mSELECT "patient_records".* FROM "patient_records" WHERE "patient_records"."id" = 'b2109def-8480-428b-951b-64e334bbef7f' LIMIT 1 /*action='headers',application='PockethealthChallenge',controller='patient_records'*/[0m
  ↳ app/controllers/patient_records_controller.rb:3:in `headers'
  [1m[36mActiveStorage::Attachment Load (0.8ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = NULL AND "active_storage_attachments"."record_type" = 'PatientRecord' AND "active_storage_attachments"."name" = 'dicom' LIMIT 1 /*action='headers',application='PockethealthChallenge',controller='patient_records'*/[0m
  ↳ (byebug):1:in `get_tag_value'
Completed 500 Internal Server Error in 82291ms (ActiveRecord: 14.9ms (2 queries, 0 cached) | GC: 17.3ms)


  
NoMethodError (undefined method `[]' for nil):
  
app/models/patient_record.rb:21:in `get_dicom_path'
app/models/patient_record.rb:11:in `get_tag_value'
app/controllers/patient_records_controller.rb:4:in `headers'
Started GET "/patient_records/b2109def-8480-428b-951b-64e334bbef7f/headers?tag=0010,0010" for 127.0.0.1 at 2025-02-17 16:07:27 -0500
  [1m[36mActiveRecord::SchemaMigration Load (43.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='PockethealthChallenge'*/[0m
Processing by PatientRecordsController#headers as */*
  Parameters: {"tag"=>"0010,0010", "id"=>"b2109def-8480-428b-951b-64e334bbef7f"}
  [1m[36mPatientRecord Load (1.1ms)[0m  [1m[34mSELECT "patient_records".* FROM "patient_records" WHERE "patient_records"."id" = 'b2109def-8480-428b-951b-64e334bbef7f' LIMIT 1 /*action='headers',application='PockethealthChallenge',controller='patient_records'*/[0m
  ↳ app/controllers/patient_records_controller.rb:3:in `headers'
  [1m[36mActiveStorage::Attachment Load (64.8ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = NULL AND "active_storage_attachments"."record_type" = 'PatientRecord' AND "active_storage_attachments"."name" = 'dicom' LIMIT 1 /*action='headers',application='PockethealthChallenge',controller='patient_records'*/[0m
  ↳ (byebug):1:in `get_tag_value'
Completed 500 Internal Server Error in 776858ms (ActiveRecord: 219.6ms (2 queries, 0 cached) | GC: 214.7ms)


  
NoMethodError (undefined method `[]' for nil):
  
app/models/patient_record.rb:21:in `get_dicom_path'
app/models/patient_record.rb:11:in `get_tag_value'
app/controllers/patient_records_controller.rb:4:in `headers'
  [1m[36mPatientRecord Load (0.7ms)[0m  [1m[34mSELECT "patient_records".* FROM "patient_records" ORDER BY "patient_records"."id" ASC LIMIT 1 /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveStorage::Attachment Load (1.0ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = 386 AND "active_storage_attachments"."record_type" = 'PatientRecord' AND "active_storage_attachments"."name" = 'dicom' LIMIT 1 /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveStorage::Blob Load (0.7ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" WHERE "active_storage_blobs"."id" = 1 LIMIT 1 /*application='PockethealthChallenge'*/[0m
Started GET "/patient_records/b2109def-8480-428b-951b-64e334bbef7f/headers?tag=0010,0010" for 127.0.0.1 at 2025-02-17 16:24:14 -0500
  [1m[36mActiveRecord::SchemaMigration Load (41.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='PockethealthChallenge'*/[0m
Processing by PatientRecordsController#headers as */*
  Parameters: {"tag"=>"0010,0010", "id"=>"b2109def-8480-428b-951b-64e334bbef7f"}
  [1m[36mPatientRecord Load (1.2ms)[0m  [1m[34mSELECT "patient_records".* FROM "patient_records" WHERE "patient_records"."id" = 'b2109def-8480-428b-951b-64e334bbef7f' LIMIT 1 /*action='headers',application='PockethealthChallenge',controller='patient_records'*/[0m
  ↳ app/controllers/patient_records_controller.rb:3:in `headers'
  [1m[36mActiveStorage::Attachment Load (1.3ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = NULL AND "active_storage_attachments"."record_type" = 'PatientRecord' AND "active_storage_attachments"."name" = 'dicom' LIMIT 1 /*action='headers',application='PockethealthChallenge',controller='patient_records'*/[0m
  ↳ (byebug):1:in `get_tag_value'
Completed 500 Internal Server Error in 282704ms (ActiveRecord: 39.2ms (2 queries, 0 cached) | GC: 56.7ms)


  
SystemExit (exit):
  
(byebug):1:in `exit'
(byebug):1:in `get_tag_value'
app/models/patient_record.rb:11:in `get_tag_value'
app/controllers/patient_records_controller.rb:4:in `headers'
  [1m[36mActiveRecord::SchemaMigration Load (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='PockethealthChallenge'*/[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_try_advisory_lock(8641812598185061470) /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='PockethealthChallenge'*/[0m
Migrating to CreatePatientRecords (20250217194000)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='PockethealthChallenge'*/[0m
  [1m[35m (50.8ms)[0m  [1m[35mDROP TABLE "patient_records" /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveRecord::SchemaMigration Destroy (0.7ms)[0m  [1m[31mDELETE FROM "schema_migrations" WHERE "schema_migrations"."version" = '20250217194000' /*application='PockethealthChallenge'*/[0m
  [1m[36mTRANSACTION (2.6ms)[0m  [1m[35mCOMMIT /*application='PockethealthChallenge'*/[0m
Migrating to CreateActiveStorageTables (20250217184629)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='PockethealthChallenge'*/[0m
  [1m[35m (5.5ms)[0m  [1m[35mDROP TABLE "active_storage_variant_records" /*application='PockethealthChallenge'*/[0m
  [1m[35m (1.3ms)[0m  [1m[35mDROP TABLE "active_storage_attachments" /*application='PockethealthChallenge'*/[0m
  [1m[35m (2.1ms)[0m  [1m[35mDROP TABLE "active_storage_blobs" /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveRecord::SchemaMigration Destroy (0.4ms)[0m  [1m[31mDELETE FROM "schema_migrations" WHERE "schema_migrations"."version" = '20250217184629' /*application='PockethealthChallenge'*/[0m
  [1m[36mTRANSACTION (8.6ms)[0m  [1m[35mCOMMIT /*application='PockethealthChallenge'*/[0m
  [1m[35m (1.7ms)[0m  [1m[34mSELECT pg_advisory_unlock(8641812598185061470) /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='PockethealthChallenge'*/[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_try_advisory_lock(8641812598185061470) /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='PockethealthChallenge'*/[0m
Migrating to CreateActiveStorageTables (20250217184629)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='PockethealthChallenge'*/[0m
  [1m[35m (10.3ms)[0m  [1m[35mCREATE TABLE "active_storage_blobs" ("id" uuid DEFAULT gen_random_uuid() NOT NULL PRIMARY KEY, "key" character varying NOT NULL, "filename" character varying NOT NULL, "content_type" character varying, "metadata" text, "service_name" character varying NOT NULL, "byte_size" bigint NOT NULL, "checksum" character varying, "created_at" timestamp(6) NOT NULL) /*application='PockethealthChallenge'*/[0m
  [1m[35m (2.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_active_storage_blobs_on_key" ON "active_storage_blobs" ("key") /*application='PockethealthChallenge'*/[0m
  [1m[35m (10.5ms)[0m  [1m[35mCREATE TABLE "active_storage_attachments" ("id" uuid DEFAULT gen_random_uuid() NOT NULL PRIMARY KEY, "name" character varying NOT NULL, "record_type" character varying NOT NULL, "record_id" uuid NOT NULL, "blob_id" uuid NOT NULL, "created_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_c3b3935057"
FOREIGN KEY ("blob_id")
  REFERENCES "active_storage_blobs" ("id")
) /*application='PockethealthChallenge'*/[0m
  [1m[35m (2.3ms)[0m  [1m[35mCREATE INDEX "index_active_storage_attachments_on_blob_id" ON "active_storage_attachments" ("blob_id") /*application='PockethealthChallenge'*/[0m
  [1m[35m (2.4ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_active_storage_attachments_uniqueness" ON "active_storage_attachments" ("record_type", "record_id", "name", "blob_id") /*application='PockethealthChallenge'*/[0m
  [1m[35m (10.1ms)[0m  [1m[35mCREATE TABLE "active_storage_variant_records" ("id" uuid DEFAULT gen_random_uuid() NOT NULL PRIMARY KEY, "blob_id" uuid NOT NULL, "variation_digest" character varying NOT NULL, CONSTRAINT "fk_rails_993965df05"
FOREIGN KEY ("blob_id")
  REFERENCES "active_storage_blobs" ("id")
) /*application='PockethealthChallenge'*/[0m
  [1m[35m (5.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_active_storage_variant_records_uniqueness" ON "active_storage_variant_records" ("blob_id", "variation_digest") /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250217184629') RETURNING "version" /*application='PockethealthChallenge'*/[0m
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT /*application='PockethealthChallenge'*/[0m
Migrating to CreatePatientRecords (20250217194000)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='PockethealthChallenge'*/[0m
  [1m[35m (6.1ms)[0m  [1m[35mCREATE TABLE "patient_records" ("id" uuid NOT NULL PRIMARY KEY, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL) /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveRecord::SchemaMigration Create (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20250217194000') RETURNING "version" /*application='PockethealthChallenge'*/[0m
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mCOMMIT /*application='PockethealthChallenge'*/[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT pg_advisory_unlock(8641812598185061470) /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='PockethealthChallenge'*/[0m
  [1m[36mPatientRecord Count (24.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "patient_records" /*application='PockethealthChallenge'*/[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*application='PockethealthChallenge'*/[0m
  [1m[36mPatientRecord Create (1.4ms)[0m  [1m[32mINSERT INTO "patient_records" ("id", "created_at", "updated_at") VALUES ('86154331-f24a-4b49-9efc-2b3a463a1ad3', '2025-02-17 21:31:13.283555', '2025-02-17 21:31:13.283555') RETURNING "id" /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveStorage::Blob Load (1.5ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" INNER JOIN "active_storage_attachments" ON "active_storage_blobs"."id" = "active_storage_attachments"."blob_id" WHERE "active_storage_attachments"."record_id" = '86154331-f24a-4b49-9efc-2b3a463a1ad3' AND "active_storage_attachments"."record_type" = 'PatientRecord' AND "active_storage_attachments"."name" = 'dicom' LIMIT 1 /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveStorage::Attachment Load (0.6ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = '86154331-f24a-4b49-9efc-2b3a463a1ad3' AND "active_storage_attachments"."record_type" = 'PatientRecord' AND "active_storage_attachments"."name" = 'dicom' LIMIT 1 /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveStorage::Blob Create (1.9ms)[0m  [1m[32mINSERT INTO "active_storage_blobs" ("key", "filename", "content_type", "metadata", "service_name", "byte_size", "checksum", "created_at") VALUES ('ombl1g9r6zv8m0hohm4mrslji29m', 'IM000001', 'application/dicom', '{"identified":true}', 'local', 586394, '0ptuzwN5PfenXnpMk68Keg==', '2025-02-17 21:31:13.381569') RETURNING "id" /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveStorage::Attachment Create (2.3ms)[0m  [1m[32mINSERT INTO "active_storage_attachments" ("name", "record_type", "record_id", "blob_id", "created_at") VALUES ('dicom', 'PatientRecord', '86154331-f24a-4b49-9efc-2b3a463a1ad3', 'ee9c6123-c2c1-4c6a-bce4-306cf8f78358', '2025-02-17 21:31:13.389840') RETURNING "id" /*application='PockethealthChallenge'*/[0m
  [1m[36mPatientRecord Update (2.8ms)[0m  [1m[33mUPDATE "patient_records" SET "updated_at" = '2025-02-17 21:31:13.394847' WHERE "patient_records"."id" = '86154331-f24a-4b49-9efc-2b3a463a1ad3' /*application='PockethealthChallenge'*/[0m
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT /*application='PockethealthChallenge'*/[0m
[36m  Disk Storage (4.4ms) [0m[32mUploaded file to key: ombl1g9r6zv8m0hohm4mrslji29m (checksum: 0ptuzwN5PfenXnpMk68Keg==)[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveStorage::Blob Update (5.1ms)[0m  [1m[33mUPDATE "active_storage_blobs" SET "metadata" = '{"identified":true,"analyzed":true}' WHERE "active_storage_blobs"."id" = 'ee9c6123-c2c1-4c6a-bce4-306cf8f78358' /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveStorage::Attachment Load (1.1ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."blob_id" = 'ee9c6123-c2c1-4c6a-bce4-306cf8f78358' /*application='PockethealthChallenge'*/[0m
  [1m[36mPatientRecord Load (0.4ms)[0m  [1m[34mSELECT "patient_records".* FROM "patient_records" WHERE "patient_records"."id" = '86154331-f24a-4b49-9efc-2b3a463a1ad3' /*application='PockethealthChallenge'*/[0m
  [1m[36mPatientRecord Update (0.5ms)[0m  [1m[33mUPDATE "patient_records" SET "updated_at" = '2025-02-17 21:31:13.467592' WHERE "patient_records"."id" = '86154331-f24a-4b49-9efc-2b3a463a1ad3' /*application='PockethealthChallenge'*/[0m
  [1m[36mTRANSACTION (40.3ms)[0m  [1m[35mCOMMIT /*application='PockethealthChallenge'*/[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN /*application='PockethealthChallenge'*/[0m
  [1m[36mPatientRecord Create (0.8ms)[0m  [1m[32mINSERT INTO "patient_records" ("id", "created_at", "updated_at") VALUES ('46fa1597-b637-4420-9252-402afa3b7648', '2025-02-17 21:31:27.682695', '2025-02-17 21:31:27.682695') RETURNING "id" /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveStorage::Blob Load (1.9ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" INNER JOIN "active_storage_attachments" ON "active_storage_blobs"."id" = "active_storage_attachments"."blob_id" WHERE "active_storage_attachments"."record_id" = '46fa1597-b637-4420-9252-402afa3b7648' AND "active_storage_attachments"."record_type" = 'PatientRecord' AND "active_storage_attachments"."name" = 'dicom' LIMIT 1 /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveStorage::Attachment Load (0.6ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = '46fa1597-b637-4420-9252-402afa3b7648' AND "active_storage_attachments"."record_type" = 'PatientRecord' AND "active_storage_attachments"."name" = 'dicom' LIMIT 1 /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveStorage::Blob Create (0.4ms)[0m  [1m[32mINSERT INTO "active_storage_blobs" ("key", "filename", "content_type", "metadata", "service_name", "byte_size", "checksum", "created_at") VALUES ('90e9kxmsqvmpi7ik1ob16ki4upt9', 'IM000002', 'application/dicom', '{"identified":true}', 'local', 586392, '4AE2eKkEiB9SvJu340+8GA==', '2025-02-17 21:31:27.693345') RETURNING "id" /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveStorage::Attachment Create (0.5ms)[0m  [1m[32mINSERT INTO "active_storage_attachments" ("name", "record_type", "record_id", "blob_id", "created_at") VALUES ('dicom', 'PatientRecord', '46fa1597-b637-4420-9252-402afa3b7648', '9f8ad7f6-cd32-49a9-b8ab-8c3d8735f7aa', '2025-02-17 21:31:27.695614') RETURNING "id" /*application='PockethealthChallenge'*/[0m
  [1m[36mPatientRecord Update (0.6ms)[0m  [1m[33mUPDATE "patient_records" SET "updated_at" = '2025-02-17 21:31:27.697113' WHERE "patient_records"."id" = '46fa1597-b637-4420-9252-402afa3b7648' /*application='PockethealthChallenge'*/[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT /*application='PockethealthChallenge'*/[0m
[36m  Disk Storage (7.4ms) [0m[32mUploaded file to key: 90e9kxmsqvmpi7ik1ob16ki4upt9 (checksum: 4AE2eKkEiB9SvJu340+8GA==)[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveStorage::Blob Update (3.5ms)[0m  [1m[33mUPDATE "active_storage_blobs" SET "metadata" = '{"identified":true,"analyzed":true}' WHERE "active_storage_blobs"."id" = '9f8ad7f6-cd32-49a9-b8ab-8c3d8735f7aa' /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveStorage::Attachment Load (0.7ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."blob_id" = '9f8ad7f6-cd32-49a9-b8ab-8c3d8735f7aa' /*application='PockethealthChallenge'*/[0m
  [1m[36mPatientRecord Load (0.4ms)[0m  [1m[34mSELECT "patient_records".* FROM "patient_records" WHERE "patient_records"."id" = '46fa1597-b637-4420-9252-402afa3b7648' /*application='PockethealthChallenge'*/[0m
  [1m[36mPatientRecord Update (0.9ms)[0m  [1m[33mUPDATE "patient_records" SET "updated_at" = '2025-02-17 21:31:27.727642' WHERE "patient_records"."id" = '46fa1597-b637-4420-9252-402afa3b7648' /*application='PockethealthChallenge'*/[0m
  [1m[36mTRANSACTION (10.1ms)[0m  [1m[35mCOMMIT /*application='PockethealthChallenge'*/[0m
  [1m[36mPatientRecord Load (0.8ms)[0m  [1m[34mSELECT "patient_records".* FROM "patient_records" ORDER BY "patient_records"."id" ASC LIMIT 1 /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveStorage::Attachment Load (0.5ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = '46fa1597-b637-4420-9252-402afa3b7648' AND "active_storage_attachments"."record_type" = 'PatientRecord' AND "active_storage_attachments"."name" = 'dicom' LIMIT 1 /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveStorage::Blob Load (0.5ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" WHERE "active_storage_blobs"."id" = '9f8ad7f6-cd32-49a9-b8ab-8c3d8735f7aa' LIMIT 1 /*application='PockethealthChallenge'*/[0m
  [1m[36mPatientRecord Load (1.7ms)[0m  [1m[34mSELECT "patient_records".* FROM "patient_records" ORDER BY "patient_records"."id" DESC LIMIT 1 /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveStorage::Attachment Load (0.4ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = '86154331-f24a-4b49-9efc-2b3a463a1ad3' AND "active_storage_attachments"."record_type" = 'PatientRecord' AND "active_storage_attachments"."name" = 'dicom' LIMIT 1 /*application='PockethealthChallenge'*/[0m
  [1m[36mActiveStorage::Blob Load (0.6ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" WHERE "active_storage_blobs"."id" = 'ee9c6123-c2c1-4c6a-bce4-306cf8f78358' LIMIT 1 /*application='PockethealthChallenge'*/[0m
Started GET "/patient_records/46fa1597-b637-4420-9252-402afa3b7648/headers?tag=0010,0010" for 127.0.0.1 at 2025-02-17 16:33:21 -0500
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='PockethealthChallenge'*/[0m
Processing by PatientRecordsController#headers as */*
  Parameters: {"tag"=>"0010,0010", "id"=>"46fa1597-b637-4420-9252-402afa3b7648"}
  [1m[36mPatientRecord Load (0.6ms)[0m  [1m[34mSELECT "patient_records".* FROM "patient_records" WHERE "patient_records"."id" = '46fa1597-b637-4420-9252-402afa3b7648' LIMIT 1 /*action='headers',application='PockethealthChallenge',controller='patient_records'*/[0m
  ↳ app/controllers/patient_records_controller.rb:3:in `headers'
  [1m[36mActiveStorage::Attachment Load (1.0ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = '46fa1597-b637-4420-9252-402afa3b7648' AND "active_storage_attachments"."record_type" = 'PatientRecord' AND "active_storage_attachments"."name" = 'dicom' LIMIT 1 /*action='headers',application='PockethealthChallenge',controller='patient_records'*/[0m
  ↳ (byebug):1:in `get_tag_value'
  [1m[36mActiveStorage::Blob Load (0.7ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" WHERE "active_storage_blobs"."id" = '9f8ad7f6-cd32-49a9-b8ab-8c3d8735f7aa' LIMIT 1 /*action='headers',application='PockethealthChallenge',controller='patient_records'*/[0m
  ↳ (byebug):1:in `get_tag_value'
DICOM: DICOM string successfully parsed.
DICOM: DICOM file successfully read: /Users/Io/pockethealth-challenge/storage/90/e9/90e9kxmsqvmpi7ik1ob16ki4upt9
Completed 200 OK in 23401ms (Views: 2.1ms | ActiveRecord: 49.6ms (3 queries, 0 cached) | GC: 109.6ms)


